<!DOCTYPE HTML>
<html lang="en">
{% load staticfiles %}
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">

    <title>Pilapse Web Interface v0.0</title>


    <script src="{% static 'jquery.min.js' %}"></script>

    <script>
    function loadImage() {
        $('#imageFrame').fadeTo('fast', 0.5);
        path=baseurl()+"static/new.jpg"
        width=320;
        height=240;
        target='#imageFrame';
        X=$('<img src="'+ path +'">').width(width).height(height);
        $(target).html(X);
        $('#imageFrame').fadeTo('fast', 1.0);
    }

    function baseurl() {
        path=document.URL
        path=path.replace( "djpilapp/", "" )
        return path
    };

    //Stack to place requests to the server on.
    functionStack=[]

    $(document).ready( function(){
        //Navigation buttons.
        $('.photoButton').click(function(){
            iso=photoForm.elements['iso'].value
            ss=photoForm.elements['shutterspeed'].value*100
            url=baseurl()+'djpilapp/shoot/'+ss+'/'+iso+'/'
            console.log(url)
            waittime=ss/100+500
            $.ajax(url).done( function(){
                $('#imageFrame').fadeTo('fast', 0.5);
                setTimeout(function(){
                    functionStack.push( loadImage );
                },waittime);
            });
        });
        $('.refreshButton').click(function(){
            console.log(path);
            functionStack.push( loadImage );
        });
        $('.calibrateButton').click(function(){
            url=baseurl()+'djpilapp/findinitialparams/'
            $.ajax(url);
        });
        $('.navbutton').mouseenter(function(){$(this).fadeTo('slow',0.75)});
        $('.navbutton').mouseleave(function(){$(this).fadeTo('slow',1.0)});

        //JSON Updates
        setInterval(function() {
            path=baseurl()+'djpilapp/jsonupdate/'
            $.getJSON( path, function( data ) {
                if (functionStack.length>0) {
                    f=functionStack.pop();
                    f();
                }
                else {
                    $('#jsontarget').html(data['time'])
                }
            });
        }, 2000);
    });
    </script>

</head>

<body>

<h1>PiLapse Web Interface v0.0</h1>

<table>

    <tr>
    <td>
        <h2>Last picture taken:</h2>
        <span id="imageFrame">
        <img id="lastImage" src="{% static "new.jpg" %}" width=320 height=240>
        </span>
    </td>

    <td>
        <form id="photoForm">
        Shutter speed: <input type="number" name="shutterspeed" value=500><br>
        ISO:    <input type="number" name="iso" value=100><br>
        </form>

        <nav style="display:block; margin:auto;">
        <ol style="list-style-type:none;">
        <li class="photoButton navbutton" style="border:1px dotted black; padding:.25em; width:5em; display:inline;">Take a picture!</li>
        <li class="refreshButton navbutton" style="border:1px dotted black; padding:.25em; width:5em; display:inline;">Refresh Image</li>
        </ol>
        </nav>
    </td>

    <td>
    <h3>PiLapse Project</h3>
    <ul>
        <li> Name: {{ project.project_name }} </li>
        <li> Folder: {{ project.folder }} </li>
        <li> Interval: {{ project.interval }} </li>
        <li> Height: {{ project.height }} </li>
        <li> Width: {{ project.width }} </li>
        <li> Brightness: {{ project.brightness }} </li>
        <li> Delta: {{ project.delta }} </li>
        <li> Listen Mode: {{ project.listen }} </li>
        <li> Keep Images: {{ project.keep_images }} </li>
    </ul>
    <li class="calibrateButton navbutton" style="border:1px dotted black; padding:.25em; width:5em; display:inline;">Find SS/ISO</li>
    </td>

    <td>
    <h3>PiLapser</h3>
    <ul>
        <li> Active: {{ pilapse.active }} </li>
        <li> Start on boot: {{ pilapse.boot }} </li>
        <li> Project: {{ pilapse.project }} </li>
        <li> Current SS: {{ pilapse.ss }} </li>
        <li> Current ISO: {{ pilapse.iso }} </li>
        <li> Avg Brightness: {{ pilapse.lastbr }} </li>
        <li> Shots taken: {{ pilapse.shots_taken }} </li>
        <li> Avg Brightness: {{ pilapse.lastbr }} </li>
    </ul>
    </td>

    </tr>
</table>

<div id='jsontarget'>
</div>

</body>
